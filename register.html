<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Register</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ... [Same CSS â€“ no changes] ... */
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>

  <div class="form-box">
    <h2>Student Registration</h2>
    <input type="text" id="name" placeholder="Enter Full Name" required />
    <select disabled>
      <option>B.Tech. / B.E.</option>
    </select>
    <select disabled>
      <option>CSE - AI & ML</option>
    </select>
    <label for="photo">Upload Photo</label>
    <input type="file" id="photo" accept="image/*" onchange="previewPhoto(event)" />
    <img id="preview" src="https://via.placeholder.com/100" alt="Preview" />
    <button onclick="saveData()">Register</button>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD4Lk0EjPJAYPPKdzTBb-IOMP7kpzEmrFA",
      authDomain: "studentdashboard-final.firebaseapp.com",
      projectId: "studentdashboard-final",
      storageBucket: "studentdashboard-final.firebasestorage.app",
      messagingSenderId: "576065271267",
      appId: "1:576065271267:web:05636f4ae4236f3298dcd6",
      measurementId: "G-PQXQE19D1F"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let photoData = "";
    const index = sessionStorage.getItem("currentIndex");

    if (!index) window.location.href = "index.html";

    function previewPhoto(event) {
      const reader = new FileReader();
      reader.onload = function() {
        photoData = reader.result;
        document.getElementById("preview").src = photoData;
      };
      reader.readAsDataURL(event.target.files[0]);
    }

    async function saveData() {
      const name = document.getElementById("name").value.trim();
      if (!name || !photoData) {
        alert("Please fill in your name and upload a photo.");
        return;
      }

      const studentData = {
        name,
        class: "B.Tech. / B.E.",
        branch: "CSE - Artificial Intelligence and Machine Learning",
        photo: photoData,
        index: index
      };

      try {
        const doc = await db.collection("students").doc(index).get();
        if (doc.exists) {
          alert("This index is already registered.");
          window.location.href = "dashboard.html";
        } else {
          await db.collection("students").doc(index).set(studentData);
          alert("Registration successful!");
          window.location.href = "dashboard.html";
        }
      } catch (e) {
        alert("Registration failed. Please try again.");
        console.error("Firebase error:", e);
      }
    }
  </script>

</body>
</html>