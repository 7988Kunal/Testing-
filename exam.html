<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Python Programming CBT Exam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
  document.addEventListener('contextmenu', function (e) {
    e.preventDefault();
  });
</script>
<script>
  document.onkeydown = function(e) {
    if (
      e.keyCode === 123 || // F12
      (e.ctrlKey && e.shiftKey && e.keyCode === 73) || // Ctrl+Shift+I
      (e.ctrlKey && e.keyCode === 85) // Ctrl+U
    ) {
      return false;
    }
  };
</script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
       -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-user-drag: none;
  -khtml-user-drag: none;
  -moz-user-drag: none;
  -o-user-drag: none;
  user-drag: none;
    }
    .header {
      background: #003366;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .container {
      display: flex;
      padding: 10px;
    }
    .left-panel {
      width: 70%;
      padding: 10px;
      background: white;
      border-radius: 10px;
    }
    .right-panel {
      width: 30%;
      padding: 10px;
    }
    .question-box {
      margin-bottom: 20px;
    }
    .question-number {
      font-weight: bold;
    }
    .options {
      margin-top: 10px;
    }
    .options label {
      display: block;
      margin-bottom: 5px;
    }
    .buttons button {
      margin: 5px;
    }
    .status-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }
    .status-btn {
      width: 30px;
      height: 30px;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .not-visited { background: #d3d3d3; }
    .not-answered { background: #f0ad4e; }
    .answered { background: #5cb85c; }
    .review { background: #800080; }
    .ans-review { background: #1e90ff; }
    .legend span {
      display: inline-block;
      width: 15px;
      height: 15px;
      margin-right: 5px;
    }
    .timer {
      font-size: 18px;
      font-weight: bold;
    }
    .student-info {
      font-size: 14px;
      line-height: 1.4;
    }
    .submit-btn:disabled {
      background-color: grey;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: not-allowed;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="student-info">
      <strong>Candidate:</strong> <span id="studentName">Loading...</span><br>
      <strong>Roll No:</strong> <span id="rollNumber">Loading...</span><br>
      <strong>Reg No:</strong> <span id="regNumber">Loading...</span>
    </div>
    <div class="timer" id="timer">25:00</div>
  </div>
  <div class="container">
    <div class="left-panel">
      <div class="question-box" id="question-box">
        <div class="question-number" id="q-number"></div>
        <div class="question-text" id="q-text"></div>
        <div class="options" id="q-options"></div>
      </div>
      <div class="buttons">
        <button onclick="saveAndNext()">Save & Next</button>
        <button onclick="markForReview()">Mark for Review</button>
        <button onclick="clearResponse()">Clear Response</button>
        <!--<button class="submit-btn" disabled>Final Submit (Auto)</button>-->
        <button class="submit-btn" onclick="finalSubmit()">Final Submit</button>
      </div>
    </div>
    <div class="right-panel">
      <h4>Question Status</h4>
      <div class="status-grid" id="status-grid"></div>
      <div class="legend">
        <p><span class="not-visited"></span> Not Visited</p>
        <p><span class="not-answered"></span> Not Answered</p>
        <p><span class="answered"></span> Answered</p>
        <p><span class="review"></span> Marked for Review</p>
        <p><span class="ans-review"></span> Answered & Review</p>
      </div>
    </div>
  </div>
 <!-- <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const firebaseConfig = {
  apiKey: "AIzaSyAz-yo7PmFo0eFyzfjQwCP3yiB5GqqpTp0",
  authDomain: "studentdashboard-681a8.firebaseapp.com",
  projectId: "studentdashboard-681a8",
  storageBucket: "studentdashboard-681a8.firebasestorage.app",
  messagingSenderId: "171483691299",
  appId: "1:171483691299:web:f2bc4e00b696c55b4cf496",
  measurementId: "G-RVFB0Z9TFS"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const questions = [
      {
        question: "Which of the following is used to define a block of code in Python?",
        options: ["Curly braces", "Parentheses", "Indentation", "Quotation marks"],
        answer: 2
      },
      {
        question: "What is the output of: print(2 ** 3 ** 2)?",
        options: ["64", "512", "256", "None"],
        answer: 1
      },
      {
        question: "Which of these is a mutable built-in type in Python?",
        options: ["str", "list", "tuple", "int"],
        answer: 1
      },
      {
        question: "Which of these methods can be used with dictionaries?",
        options: ["append()", "add()", "update()", "extend()"],
        answer: 2
      },
      {
        question: "What is the result of list(range(0, 10, 2))?",
        options: ["[2, 4, 6, 8, 10]", "[0, 2, 4, 6, 8]", "[1, 3, 5, 7, 9]", "[0, 2, 4, 6, 8, 10]"],
        answer: 1
      },
      {
        question: "Which module in Python supports regular expressions?",
        options: ["pyregex", "regexlib", "re", "regexp"],
        answer: 2
      },
      {
        question: "What is the correct syntax to open a file named 'data.txt' for reading?",
        options: ["open('data.txt', 'r')", "open('data.txt', 'read')", "file('data.txt')", "open.read('data.txt')"],
        answer: 0
      },
      {
        question: "Which keyword is used to create a generator in Python?",
        options: ["iter", "yield", "return", "gen"],
        answer: 1
      },
      {
        question: "Which of these is not a valid set operation?",
        options: ["union()", "intersect()", "difference()", "symmetric_difference()"],
        answer: 1
      },
      {
        question: "What is the output of print(type(lambda x: x))?",
        options: ["<class 'function'>", "<class 'lambda'>", "<class 'object'>", "<lambda 'function'>"],
        answer: 0
      },
      {
        question: "Which of these is a correct decorator syntax?",
        options: ["@decorator", "#decorator", "$decorator", "decorator@"],
        answer: 0
      },
      {
        question: "What does the 'pass' keyword do in Python?",
        options: ["Stops execution", "Skips to next line", "Does nothing", "Throws exception"],
        answer: 2
      },
      {
        question: "Which of these exceptions is raised when dividing by zero?",
        options: ["ZeroError", "ZeroDivisionError", "ArithmeticError", "MathError"],
        answer: 1
      },
      {
        question: "Which of these can be used as keys in a dictionary?",
        options: ["lists", "sets", "tuples", "dictionaries"],
        answer: 2
      },
      {
        question: "Which operator is used for floor division in Python?",
        options: ["/", "%", "//", "div"],
        answer: 2
      },
      {
        question: "Which built-in function returns the length of a list?",
        options: ["length()", "size()", "len()", "count()"],
        answer: 2
      },
      {
        question: "Which function converts a string to an integer in Python?",
        options: ["parseInt()", "int()", "float()", "str()"],
        answer: 1
      },
      {
        question: "Which method is used to add an item at the end of a list?",
        options: ["insert()", "add()", "append()", "extend()"],
        answer: 2
      },
      {
        question: "Which of the following data types is immutable?",
        options: ["list", "set", "dict", "str"],
        answer: 3
      },
      {
        question: "Which function is used to get user input in Python 3?",
        options: ["get()", "input()", "read()", "scan()"],
        answer: 1
      }
    ];
let current = 0;
let responses = Array(questions.length).fill(null);
let status = Array(questions.length).fill("not-visited");
const TOTAL_TIME_SECONDS = 1 * 60;

function loadStudentDetails() {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");
  if (!name || !roll || !reg) {
    alert("Unauthorized access. Please login first.");
    window.location.href = "index.html";
    return;
  }
  document.getElementById("studentName").textContent = name;
  document.getElementById("rollNumber").textContent = roll;
  document.getElementById("regNumber").textContent = reg;
}

function loadQuestion(index) {
  const q = questions[index];
  document.getElementById("q-number").textContent = `Q${index + 1}`;
  document.getElementById("q-text").textContent = q.question;
  document.getElementById("q-options").innerHTML = q.options.map((opt, i) =>
    `<label><input type="radio" name="option" value="${i}" ${responses[index] == i ? 'checked' : ''}> ${opt}</label>`
  ).join("");
  if (status[index] === "not-visited") status[index] = "not-answered";
  renderStatus();
}

function renderStatus() {
  document.getElementById("status-grid").innerHTML = status.map((s, i) =>
    `<button class="status-btn ${s}" onclick="goto(${i})">${i + 1}</button>`
  ).join("");
}

window.saveAndNext = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = status[current] === "review" ? "ans-review" : "answered";
  } else {
    status[current] = "not-answered";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.markForReview = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = "ans-review";
  } else {
    status[current] = "review";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.clearResponse = function () {
  responses[current] = null;
  status[current] = "not-answered";
  loadQuestion(current);
}

window.goto = function (index) {
  current = index;
  loadQuestion(index);
}

function startTimer() {
  const timerElement = document.getElementById("timer");
  let startTime = sessionStorage.getItem("examStartTime");
  if (!startTime) {
    startTime = Date.now();
    sessionStorage.setItem("examStartTime", startTime);
  } else {
    startTime = parseInt(startTime);
  }
  const interval = setInterval(() => {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    const remaining = TOTAL_TIME_SECONDS - elapsed;
    if (remaining <= 0) {
      clearInterval(interval);
      alert("⏰ Time's up! Submitting your exam...");
      finalSubmit();
    }
    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerElement.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }, 1000);
}

window.finalSubmit = async function () {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  const total = questions.length;
  const answered = responses.filter(r => r !== null).length;
  const notAnswered = status.filter(s => s === "not-answered").length;
  const review = status.filter(s => s === "review").length;
  const ansReview = status.filter(s => s === "ans-review").length;

  const responseData = {
    name,
    roll,
    reg,
    responses,
    status,
    answered,
    notAnswered,
    review,
    ansReview,
    submittedAt: serverTimestamp()
  };

  try {
    await setDoc(doc(db, "examResponses", reg), responseData);
    alert(`Exam Submitted Successfully!\nTotal Questions: ${total}\nAnswered: ${answered}\nNot Answered: ${notAnswered}\nReview: ${review}\nAnswered & Review: ${ansReview}`);
    sessionStorage.clear();
    window.location.href = "thankyou.html";
  } catch (err) {
    alert("❌ Submission failed. Please check your connection.");
    console.error("Firestore Error:", err);
  }
}

window.onload = () => {
  loadStudentDetails();
  loadQuestion(current);
  startTimer();
  window.onbeforeunload = null;
}

document.addEventListener("keydown", function (e) {
  if ((e.key === "F5") || (e.ctrlKey && e.key === "r")) {
    e.preventDefault();
    alert("🔒 Refresh is disabled during the exam!");
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());
history.pushState(null, null, location.href);
window.onpopstate = function () { history.go(1); }

  </script>-->
 <!-- <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAz-yo7PmFo0eFyzfjQwCP3yiB5GqqpTp0",
  authDomain: "studentdashboard-681a8.firebaseapp.com",
  projectId: "studentdashboard-681a8",
  storageBucket: "studentdashboard-681a8.firebasestorage.app",
  messagingSenderId: "171483691299",
  appId: "1:171483691299:web:f2bc4e00b696c55b4cf496",
  measurementId: "G-RVFB0Z9TFS"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const questions = [ /* SAME 20 questions as before */ 
  {
    question: "Which of the following is used to define a block of code in Python?",
    options: ["Curly braces", "Parentheses", "Indentation", "Quotation marks"],
    answer: 2
  },
  {
    question: "What is the output of: print(2 ** 3 ** 2)?",
    options: ["64", "512", "256", "None"],
    answer: 1
  },
  {
    question: "Which of these is a mutable built-in type in Python?",
    options: ["str", "list", "tuple", "int"],
    answer: 1
  },
  {
    question: "Which of these methods can be used with dictionaries?",
    options: ["append()", "add()", "update()", "extend()"],
    answer: 2
  },
  {
    question: "What is the result of list(range(0, 10, 2))?",
    options: ["[2, 4, 6, 8, 10]", "[0, 2, 4, 6, 8]", "[1, 3, 5, 7, 9]", "[0, 2, 4, 6, 8, 10]"],
    answer: 1
  },
  {
    question: "Which module in Python supports regular expressions?",
    options: ["pyregex", "regexlib", "re", "regexp"],
    answer: 2
  },
  {
    question: "What is the correct syntax to open a file named 'data.txt' for reading?",
    options: ["open('data.txt', 'r')", "open('data.txt', 'read')", "file('data.txt')", "open.read('data.txt')"],
    answer: 0
  },
  {
    question: "Which keyword is used to create a generator in Python?",
    options: ["iter", "yield", "return", "gen"],
    answer: 1
  },
  {
    question: "Which of these is not a valid set operation?",
    options: ["union()", "intersect()", "difference()", "symmetric_difference()"],
    answer: 1
  },
  {
    question: "What is the output of print(type(lambda x: x))?",
    options: ["<class 'function'>", "<class 'lambda'>", "<class 'object'>", "<lambda 'function'>"],
    answer: 0
  },
  {
    question: "Which of these is a correct decorator syntax?",
    options: ["@decorator", "#decorator", "$decorator", "decorator@"],
    answer: 0
  },
  {
    question: "What does the 'pass' keyword do in Python?",
    options: ["Stops execution", "Skips to next line", "Does nothing", "Throws exception"],
    answer: 2
  },
  {
    question: "Which of these exceptions is raised when dividing by zero?",
    options: ["ZeroError", "ZeroDivisionError", "ArithmeticError", "MathError"],
    answer: 1
  },
  {
    question: "Which of these can be used as keys in a dictionary?",
    options: ["lists", "sets", "tuples", "dictionaries"],
    answer: 2
  },
  {
    question: "Which operator is used for floor division in Python?",
    options: ["/", "%", "//", "div"],
    answer: 2
  },
  {
    question: "Which built-in function returns the length of a list?",
    options: ["length()", "size()", "len()", "count()"],
    answer: 2
  },
  {
    question: "Which function converts a string to an integer in Python?",
    options: ["parseInt()", "int()", "float()", "str()"],
    answer: 1
  },
  {
    question: "Which method is used to add an item at the end of a list?",
    options: ["insert()", "add()", "append()", "extend()"],
    answer: 2
  },
  {
    question: "Which of the following data types is immutable?",
    options: ["list", "set", "dict", "str"],
    answer: 3
  },
  {
    question: "Which function is used to get user input in Python 3?",
    options: ["get()", "input()", "read()", "scan()"],
    answer: 1
  }
];

let current = parseInt(sessionStorage.getItem("currentQuestion") || "0");
let responses = JSON.parse(sessionStorage.getItem("responses") || JSON.stringify(Array(questions.length).fill(null)));
let status = JSON.parse(sessionStorage.getItem("status") || JSON.stringify(Array(questions.length).fill("not-visited")));

function loadStudentDetails() {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");
  if (!name || !roll || !reg) {
    alert("Unauthorized access. Please login first.");
    window.location.href = "index.html";
    return;
  }
  document.getElementById("studentName").textContent = name;
  document.getElementById("rollNumber").textContent = roll;
  document.getElementById("regNumber").textContent = reg;
}

function loadQuestion(index) {
  const q = questions[index];
  document.getElementById("q-number").textContent = `Q${index + 1}`;
  document.getElementById("q-text").textContent = q.question;
  document.getElementById("q-options").innerHTML = q.options.map((opt, i) =>
    `<label><input type="radio" name="option" value="${i}" ${responses[index] === i ? 'checked' : ''}> ${opt}</label>`
  ).join("");

  if (status[index] === "not-visited") status[index] = "not-answered";
  renderStatus();
  persistData();
}

function renderStatus() {
  document.getElementById("status-grid").innerHTML = status.map((s, i) =>
    `<button class="status-btn ${s}" onclick="goto(${i})">${i + 1}</button>`
  ).join("");
}

function persistData() {
  sessionStorage.setItem("responses", JSON.stringify(responses));
  sessionStorage.setItem("status", JSON.stringify(status));
  sessionStorage.setItem("currentQuestion", current.toString());
}

window.saveAndNext = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = status[current] === "review" ? "ans-review" : "answered";
  } else {
    status[current] = "not-answered";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.markForReview = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = "ans-review";
  } else {
    status[current] = "review";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.clearResponse = function () {
  responses[current] = null;
  status[current] = "not-answered";
  loadQuestion(current);
}

window.goto = function (index) {
  current = index;
  loadQuestion(index);
}

function startTimer() {
  const timerElement = document.getElementById("timer");
  let startTime = sessionStorage.getItem("examStartTime");
  if (!startTime) {
    startTime = Date.now();
    sessionStorage.setItem("examStartTime", startTime);
  } else {
    startTime = parseInt(startTime);
  }

  const interval = setInterval(() => {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    const remaining = TOTAL_TIME_SECONDS - elapsed;

    if (remaining <= 0) {
      clearInterval(interval);
      alert("⏰ Time's up! Submitting your exam...");
      finalSubmit();
    }

    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerElement.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }, 1000);
}

window.finalSubmit = async function () {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  const total = questions.length;
  const answered = responses.filter(r => r !== null).length;
  const notAnswered = status.filter(s => s === "not-answered").length;
  const review = status.filter(s => s === "review").length;
  const ansReview = status.filter(s => s === "ans-review").length;

  const responseData = {
    name,
    roll,
    reg,
    responses,
    status,
    answered,
    notAnswered,
    review,
    ansReview,
    submittedAt: serverTimestamp()
  };

  try {
    await setDoc(doc(db, "examResponses", reg), responseData);
    alert(`✅ Exam Submitted!\nTotal Questions: ${total}\nAnswered: ${answered}\nNot Answered: ${notAnswered}\nReview: ${review}\nAnswered & Review: ${ansReview}`);
    sessionStorage.clear();
    window.location.href = "thankyou.html";
  } catch (err) {
    alert("❌ Submission failed. Please check your connection.");
    console.error("Firestore Error:", err);
  }
}

window.onload = () => {
  loadStudentDetails();
  loadQuestion(current);
  startTimer();
  window.onbeforeunload = null;
}

document.addEventListener("keydown", function (e) {
  if ((e.key === "F5") || (e.ctrlKey && e.key === "r")) {
    e.preventDefault();
    alert("🔒 Refresh is disabled during the exam!");
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());
history.pushState(null, null, location.href);
window.onpopstate = function () { history.go(1); }
</script>-->
<!--<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAz-yo7PmFo0eFyzfjQwCP3yiB5GqqpTp0",
  authDomain: "studentdashboard-681a8.firebaseapp.com",
  projectId: "studentdashboard-681a8",
  storageBucket: "studentdashboard-681a8.firebasestorage.app",
  messagingSenderId: "171483691299",
  appId: "1:171483691299:web:f2bc4e00b696c55b4cf496",
  measurementId: "G-RVFB0Z9TFS"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Time in seconds ( 15 minutes)
const TOTAL_TIME_SECONDS = 15 * 60;

// Example questions (replace or load externally as needed)
const questions = [
      {
        question: "Which of the following is used to define a block of code in Python?",
        options: ["Curly braces", "Parentheses", "Indentation", "Quotation marks"],
        answer: 2
      },
      {
        question: "What is the output of: print(2 ** 3 ** 2)?",
        options: ["64", "512", "256", "None"],
        answer: 1
      },
      {
        question: "Which of these is a mutable built-in type in Python?",
        options: ["str", "list", "tuple", "int"],
        answer: 1
      },
      {
        question: "Which of these methods can be used with dictionaries?",
        options: ["append()", "add()", "update()", "extend()"],
        answer: 2
      },
      {
        question: "What is the result of list(range(0, 10, 2))?",
        options: ["[2, 4, 6, 8, 10]", "[0, 2, 4, 6, 8]", "[1, 3, 5, 7, 9]", "[0, 2, 4, 6, 8, 10]"],
        answer: 1
      },
      {
        question: "Which module in Python supports regular expressions?",
        options: ["pyregex", "regexlib", "re", "regexp"],
        answer: 2
      },
      {
        question: "What is the correct syntax to open a file named 'data.txt' for reading?",
        options: ["open('data.txt', 'r')", "open('data.txt', 'read')", "file('data.txt')", "open.read('data.txt')"],
        answer: 0
      },
      {
        question: "Which keyword is used to create a generator in Python?",
        options: ["iter", "yield", "return", "gen"],
        answer: 1
      },
      {
        question: "Which of these is not a valid set operation?",
        options: ["union()", "intersect()", "difference()", "symmetric_difference()"],
        answer: 1
      },
      {
        question: "What is the output of print(type(lambda x: x))?",
        options: ["class 'function'", "class 'lambda'", "class 'object'", "lambda 'function'"],
        answer: 0
      },
      {
        question: "Which of these is a correct decorator syntax?",
        options: ["@decorator", "#decorator", "$decorator", "decorator@"],
        answer: 0
      },
      {
        question: "What does the 'pass' keyword do in Python?",
        options: ["Stops execution", "Skips to next line", "Does nothing", "Throws exception"],
        answer: 2
      },
      {
        question: "Which of these exceptions is raised when dividing by zero?",
        options: ["ZeroError", "ZeroDivisionError", "ArithmeticError", "MathError"],
        answer: 1
      },
      {
        question: "Which of these can be used as keys in a dictionary?",
        options: ["lists", "sets", "tuples", "dictionaries"],
        answer: 2
      },
      {
        question: "Which operator is used for floor division in Python?",
        options: ["/", "%", "//", "div"],
        answer: 2
      },
      {
        question: "Which built-in function returns the length of a list?",
        options: ["length()", "size()", "len()", "count()"],
        answer: 2
      },
      {
        question: "Which function converts a string to an integer in Python?",
        options: ["parseInt()", "int()", "float()", "str()"],
        answer: 1
      },
      {
        question: "Which method is used to add an item at the end of a list?",
        options: ["insert()", "add()", "append()", "extend()"],
        answer: 2
      },
      {
        question: "Which of the following data types is immutable?",
        options: ["list", "set", "dict", "str"],
        answer: 3
      },
      {
        question: "Which function is used to get user input in Python 3?",
        options: ["get()", "input()", "read()", "scan()"],
        answer: 1
      }
    ];

let current = parseInt(sessionStorage.getItem("currentQuestion") || "0");
let responses = JSON.parse(sessionStorage.getItem("responses") || JSON.stringify(Array(questions.length).fill(null)));
let status = JSON.parse(sessionStorage.getItem("status") || JSON.stringify(Array(questions.length).fill("not-visited")));

function loadStudentDetails() {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");
  if (!name || !roll || !reg) {
    alert("Unauthorized access. Please login first.");
    window.location.href = "index.html";
    return;
  }
  document.getElementById("studentName").textContent = name;
  document.getElementById("rollNumber").textContent = roll;
  document.getElementById("regNumber").textContent = reg;
}

function loadQuestion(index) {
  const q = questions[index];
  document.getElementById("q-number").textContent = `Q${index + 1}`;
  document.getElementById("q-text").textContent = q.question;
  document.getElementById("q-options").innerHTML = q.options.map((opt, i) =>
    `<label><input type="radio" name="option" value="${i}" ${responses[index] === i ? 'checked' : ''}> ${opt}</label>`
  ).join("");

  if (status[index] === "not-visited") status[index] = "not-answered";
  renderStatus();
  persistData();
}

function renderStatus() {
  document.getElementById("status-grid").innerHTML = status.map((s, i) =>
    `<button class="status-btn ${s}" onclick="goto(${i})">${i + 1}</button>`
  ).join("");
}

function persistData() {
  sessionStorage.setItem("responses", JSON.stringify(responses));
  sessionStorage.setItem("status", JSON.stringify(status));
  sessionStorage.setItem("currentQuestion", current.toString());
}

window.saveAndNext = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = status[current] === "review" ? "ans-review" : "answered";
  } else {
    status[current] = "not-answered";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.markForReview = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = "ans-review";
  } else {
    status[current] = "review";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.clearResponse = function () {
  responses[current] = null;
  status[current] = "not-answered";
  loadQuestion(current);
}

window.goto = function (index) {
  current = index;
  loadQuestion(index);
}

function startTimer() {
  const timerElement = document.getElementById("timer");
  let startTime = sessionStorage.getItem("examStartTime");

  if (!startTime) {
    startTime = Date.now();
    sessionStorage.setItem("examStartTime", startTime);
  } else {
    startTime = parseInt(startTime);
  }

  const interval = setInterval(() => {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    const remaining = TOTAL_TIME_SECONDS - elapsed;

    /*if (remaining <= 0) {
      clearInterval(interval);
      alert("⏰ Time's up! Submitting your exam...");
      finalSubmit();
    }*/
    if (remaining <= 0) {
  clearInterval(interval);
  alert("⏰ Time's up! You can now submit your exam manually.");
  document.querySelector(".submit-btn").disabled = false;
    }

    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerElement.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }, 1000);
}

window.finalSubmit = async function () {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  const total = questions.length;
  const answered = responses.filter(r => r !== null).length;
  const notAnswered = status.filter(s => s === "not-answered").length;
  const review = status.filter(s => s === "review").length;
  const ansReview = status.filter(s => s === "ans-review").length;

  const responseData = {
    name, roll, reg,
    responses, status,
    answered, notAnswered,
    review, ansReview,
    submittedAt: serverTimestamp()
  };

  try {
    await setDoc(doc(db, "examResponses", reg), responseData);
    alert(`✅ Exam Submitted!\nTotal: ${total}\nAnswered: ${answered}\nNot Answered: ${notAnswered}\nReview: ${review}\nAnswered & Review: ${ansReview}`);
    sessionStorage.clear();
    window.location.href = "thankyou.html";
  } catch (err) {
    alert("❌ Submission failed. Please check your internet.");
    console.error("Submission Error:", err);
  }
}

window.onload = () => {
  loadStudentDetails();
  loadQuestion(current);
  startTimer();

  // Prevent leaving page
  window.onbeforeunload = null;
};

// Security & Navigation Lock
document.addEventListener("keydown", function (e) {
  if (e.key === "F5" || (e.ctrlKey && e.key === "r")) {
    e.preventDefault();
    alert("🔒 Refresh is disabled during the exam!");
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());

history.pushState(null, null, location.href);
window.onpopstate = () => history.go(1);
</script>-->
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, setDoc, getDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAz-yo7PmFo0eFyzfjQwCP3yiB5GqqpTp0",
  authDomain: "studentdashboard-681a8.firebaseapp.com",
  projectId: "studentdashboard-681a8",
  storageBucket: "studentdashboard-681a8.firebasestorage.app",
  messagingSenderId: "171483691299",
  appId: "1:171483691299:web:f2bc4e00b696c55b4cf496",
  measurementId: "G-RVFB0Z9TFS"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ⏱ Time in seconds (25 minutes)
const TOTAL_TIME_SECONDS = 25 * 60;

// ✅ Set allowed attempt count
const ALLOWED_ATTEMPTS = 1;

/*const questions = [
      {
        question: "Which of the following is used to define a block of code in Python?",
        options: ["Curly braces", "Parentheses", "Indentation", "Quotation marks"],
        answer: 2
      },
      {
        question: "What is the output of: print(2 ** 3 ** 2)?",
        options: ["64", "512", "256", "None"],
        answer: 1
      },
      {
        question: "Which of these is a mutable built-in type in Python?",
        options: ["str", "list", "tuple", "int"],
        answer: 1
      },
      {
        question: "Which of these methods can be used with dictionaries?",
        options: ["append()", "add()", "update()", "extend()"],
        answer: 2
      },
      {
        question: "What is the result of list(range(0, 10, 2))?",
        options: ["[2, 4, 6, 8, 10]", "[0, 2, 4, 6, 8]", "[1, 3, 5, 7, 9]", "[0, 2, 4, 6, 8, 10]"],
        answer: 1
      },
      {
        question: "Which module in Python supports regular expressions?",
        options: ["pyregex", "regexlib", "re", "regexp"],
        answer: 2
      },
      {
        question: "What is the correct syntax to open a file named 'data.txt' for reading?",
        options: ["open('data.txt', 'r')", "open('data.txt', 'read')", "file('data.txt')", "open.read('data.txt')"],
        answer: 0
      },
      {
        question: "Which keyword is used to create a generator in Python?",
        options: ["iter", "yield", "return", "gen"],
        answer: 1
      },
      {
        question: "Which of these is not a valid set operation?",
        options: ["union()", "intersect()", "difference()", "symmetric_difference()"],
        answer: 1
      },
      {
        question: "What is the output of print(type(lambda x: x))?",
        options: ["class 'function' ", "class 'lambda' ", " class 'object' ", " lambda 'function' "],
        answer: 0
      },
      {
        question: "Which of these is a correct decorator syntax?",
        options: ["@decorator", "#decorator", "$decorator", "decorator@"],
        answer: 0
      },
      {
        question: "What does the 'pass' keyword do in Python?",
        options: ["Stops execution", "Skips to next line", "Does nothing", "Throws exception"],
        answer: 2
      },
      {
        question: "Which of these exceptions is raised when dividing by zero?",
        options: ["ZeroError", "ZeroDivisionError", "ArithmeticError", "MathError"],
        answer: 1
      },
      {
        question: "Which of these can be used as keys in a dictionary?",
        options: ["lists", "sets", "tuples", "dictionaries"],
        answer: 2
      },
      {
        question: "Which operator is used for floor division in Python?",
        options: ["/", "%", "//", "div"],
        answer: 2
      },
      {
        question: "Which built-in function returns the length of a list?",
        options: ["length()", "size()", "len()", "count()"],
        answer: 2
      },
      {
        question: "Which function converts a string to an integer in Python?",
        options: ["parseInt()", "int()", "float()", "str()"],
        answer: 1
      },
      {
        question: "Which method is used to add an item at the end of a list?",
        options: ["insert()", "add()", "append()", "extend()"],
        answer: 2
      },
      {
        question: "Which of the following data types is immutable?",
        options: ["list", "set", "dict", "str"],
        answer: 3
      },
      {
        question: "Which function is used to get user input in Python 3?",
        options: ["get()", "input()", "read()", "scan()"],
        answer: 1
      }
    ];*/
    const questions = [
  {
    question: "What will be the output of the following code?\n\nx = [1, 2, 3]\ny = x\nx += [4, 5]\nprint(x, y)",
    options: [
      "[1, 2, 3, 4, 5] [1, 2, 3]",
      "[1, 2, 3, 4, 5] [1, 2, 3, 4, 5]",
      "[1, 2, 3] [1, 2, 3, 4, 5]",
      "[1, 2, 3, 4, 5] [4, 5]"
    ],
    answer: 1
  },
  {
    question: "Which of the following statements about Python's GIL (Global Interpreter Lock) is true?",
    options: [
      "It prevents all concurrency in Python",
      "It allows parallelism in all cases",
      "It allows only one thread to execute Python bytecode at a time",
      "It is only present in Python 3",
    ],
    answer: 2
  },
  {
    question: "What will the following code print?\n\nprint(''.join(sorted('4321', reverse=True)))",
    options: ["1234", "4321", "1243", "3412"],
    answer: 1
  },
  {
    question: "Which Python standard library module can serialize and deserialize Python objects?",
    options: ["marshal", "pickle", "json", "Both pickle and json"],
    answer: 3
  },
  {
    question: "What is the time complexity of accessing an element in a Python dictionary?",
    options: ["O(1)", "O(n)", "O(log n)", "O(n log n)"],
    answer: 0
  },
  {
    question: "What is the output of the following code?\n\ndef f(x=[]):\n  x.append(1)\n  return x\nprint(f())\nprint(f())",
    options: ["[1] [1]", "[1, 1] [1, 1]", "[1] [1, 1]", "[1, 1] [1]"],
    answer: 2
  },
  {
    question: "What is the difference between is and == in Python?",
    options: [
      "`is` compares values, `==` compares references",
      "`is` compares identity, `==` compares values",
      "They are the same",
      "`is` compares memory size"
    ],
    answer: 1
  },
  {
    question: "Which of the following methods will create a shallow copy of a list?",
    options: ["list.copy()", "list()", "copy.copy()", "All of the above"],
    answer: 3
  },
  {
    question: "Which metaclass is used in Python 3 to customize class creation?",
    options: ["type", "object", "class", "new"],
    answer: 0
  },
  {
    question: "Which of these is the correct way to handle multiple exceptions?",
    options: [
      "except (ValueError, TypeError):",
      "except ValueError, TypeError:",
      "except ValueError or TypeError:",
      "except ValueError | TypeError:"
    ],
    answer: 0
  },
  {
    question: "What is the output of this code?\n\na = (i*i for i in range(3))\nprint(list(a))",
    options: ["[1, 4, 9]", "[0, 1, 4]", "[0, 2, 4]", "[0, 1, 2]"],
    answer: 1
  },
  {
    question: "What does the '@staticmethod' decorator do?",
    options: [
      "Creates a function that cannot access class or instance variables",
      "Creates a function bound to the class",
      "Creates a class method",
      "Creates an instance method"
    ],
    answer: 0
  },
  {
    question: "Which function is used to evaluate a string as Python code?",
    options: ["exec()", "compile()", "eval()", "Both eval() and exec()"],
    answer: 3
  },
  {
    question: "What is the result of `bool('False')` in Python?",
    options: ["True", "False", "None", "Error"],
    answer: 0
  },
  {
    question: "Which of the following is true about Python's memory management?",
    options: [
      "It uses manual memory allocation",
      "It uses garbage collection and reference counting",
      "It never frees memory",
      "You must explicitly delete variables"
    ],
    answer: 1
  },
  {
    question: "What is a closure in Python?",
    options: [
      "A function that is defined inside another function and returns itself",
      "A function object that has access to variables in its lexical scope",
      "A loop inside a function",
      "An object of a class inside a function"
    ],
    answer: 1
  },
  {
    question: "Which of the following best describes a Python iterator?",
    options: [
      "An object that implements __next__() and __iter__()",
      "An object that can be indexed",
      "An object with a for loop",
      "An object with __getitem__()"
    ],
    answer: 0
  },
  {
    question: "What will be the output of:\n\nprint([i for i in range(3)])\nprint((i for i in range(3)))",
    options: [
      "[0, 1, 2] <generator object>",
      "[0, 1, 2] (0, 1, 2)",
      "[0, 1, 2] [0, 1, 2]",
      "(0, 1, 2) [0, 1, 2]"
    ],
    answer: 0
  },
  {
    question: "Which of the following will NOT raise a SyntaxError?",
    options: [
      "`a === b`",
      "`def f(:)`",
      "`if True print('Hello')`",
      "`print('Hello'))`"
    ],
    answer: 0
  },
  {
    question: "Which of the following will correctly create a set with three elements?",
    options: [
      "set = {1, 2, 3}",
      "s = set(1, 2, 3)",
      "s = set([1, 2, 3])",
      "Both A and C"
    ],
    answer: 3
  }
];

let current = parseInt(sessionStorage.getItem("currentQuestion") || "0");
let responses = JSON.parse(sessionStorage.getItem("responses") || JSON.stringify(Array(questions.length).fill(null)));
let status = JSON.parse(sessionStorage.getItem("status") || JSON.stringify(Array(questions.length).fill("not-visited")));

async function loadStudentDetails() {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  if (!name || !roll || !reg) {
    alert("Unauthorized access. Please login first.");
    window.location.href = "index.html";
    return;
  }

  // 🔁 Check previous attempts
  const responseRef = doc(db, "examResponses", reg);
  const responseSnap = await getDoc(responseRef);

  if (responseSnap.exists()) {
    const data = responseSnap.data();
    if ((data.attempts || 1) >= ALLOWED_ATTEMPTS) {
      alert("⚠️ You have already attempted this exam. Only one attempt is allowed.");
      window.location.href = "thankyou.html";
      return;
    }
  }

  document.getElementById("studentName").textContent = name;
  document.getElementById("rollNumber").textContent = roll;
  document.getElementById("regNumber").textContent = reg;
}

function loadQuestion(index) {
  const q = questions[index];
  document.getElementById("q-number").textContent = `Q${index + 1}`;
  document.getElementById("q-text").textContent = q.question;
  document.getElementById("q-options").innerHTML = q.options.map((opt, i) =>
    `<label><input type="radio" name="option" value="${i}" ${responses[index] === i ? 'checked' : ''}> ${opt}</label>`
  ).join("");

  if (status[index] === "not-visited") status[index] = "not-answered";
  renderStatus();
  persistData();
}

function renderStatus() {
  document.getElementById("status-grid").innerHTML = status.map((s, i) =>
    `<button class="status-btn ${s}" onclick="goto(${i})">${i + 1}</button>`
  ).join("");
}

function persistData() {
  sessionStorage.setItem("responses", JSON.stringify(responses));
  sessionStorage.setItem("status", JSON.stringify(status));
  sessionStorage.setItem("currentQuestion", current.toString());
}

window.saveAndNext = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = status[current] === "review" ? "ans-review" : "answered";
  } else {
    status[current] = "not-answered";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.markForReview = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = "ans-review";
  } else {
    status[current] = "review";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.clearResponse = function () {
  responses[current] = null;
  status[current] = "not-answered";
  loadQuestion(current);
}

window.goto = function (index) {
  current = index;
  loadQuestion(index);
}

function startTimer() {
  const timerElement = document.getElementById("timer");
  let startTime = sessionStorage.getItem("examStartTime");

  if (!startTime) {
    startTime = Date.now();
    sessionStorage.setItem("examStartTime", startTime);
  } else {
    startTime = parseInt(startTime);
  }

  const interval = setInterval(() => {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    const remaining = TOTAL_TIME_SECONDS - elapsed;

    if (remaining <= 0) {
      clearInterval(interval);
      alert("⏰ Time's up! You can now submit your exam manually.");
      document.querySelector(".submit-btn").disabled = false;
    }

    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerElement.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }, 1000);
}

window.finalSubmit = async function () {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  const total = questions.length;
  const answered = responses.filter(r => r !== null).length;
  const notAnswered = status.filter(s => s === "not-answered").length;
  const review = status.filter(s => s === "review").length;
  const ansReview = status.filter(s => s === "ans-review").length;

  const responseRef = doc(db, "examResponses", reg);
  const existingSnap = await getDoc(responseRef);
  let attemptCount = 1;

  if (existingSnap.exists()) {
    const existingData = existingSnap.data();
    attemptCount = (existingData.attempts || 1) + 1;
  }

  const responseData = {
    name, roll, reg,
    responses, status,
    answered, notAnswered,
    review, ansReview,
    attempts: attemptCount,
    submittedAt: serverTimestamp()
  };

  try {
    await setDoc(responseRef, responseData);
    alert(`✅ Exam Submitted!\nTotal: ${total}\nAnswered: ${answered}\nNot Answered: ${notAnswered}\nReview: ${review}\nAnswered & Review: ${ansReview}`);
    sessionStorage.clear();
    window.location.href = "thankyou.html";
  } catch (err) {
    alert("❌ Submission failed. Please check your internet.");
    console.error("Submission Error:", err);
  }
}

window.onload = () => {
  loadStudentDetails();
  loadQuestion(current);
  startTimer();

  // Prevent leaving page
  window.onbeforeunload = null;
};

// Security & Navigation Lock
document.addEventListener("keydown", function (e) {
  if (e.key === "F5" || (e.ctrlKey && e.key === "r")) {
    e.preventDefault();
    alert("🔒 Refresh is disabled during the exam!");
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());

history.pushState(null, null, location.href);
window.onpopstate = () => history.go(1);
  </script>
</body>
</html>
