<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Python Programming CBT Exam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
  document.addEventListener('contextmenu', function (e) {
    e.preventDefault();
  });
</script>
<script>
  document.onkeydown = function(e) {
    if (
      e.keyCode === 123 || // F12
      (e.ctrlKey && e.shiftKey && e.keyCode === 73) || // Ctrl+Shift+I
      (e.ctrlKey && e.keyCode === 85) // Ctrl+U
    ) {
      return false;
    }
  };
</script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
       -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-user-drag: none;
  -khtml-user-drag: none;
  -moz-user-drag: none;
  -o-user-drag: none;
  user-drag: none;
    }
    .header {
      background: #003366;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .container {
      display: flex;
      padding: 10px;
    }
    .left-panel {
      width: 70%;
      padding: 10px;
      background: white;
      border-radius: 10px;
    }
    .right-panel {
      width: 30%;
      padding: 10px;
    }
    .question-box {
      margin-bottom: 20px;
    }
    .question-number {
      font-weight: bold;
    }
    .options {
      margin-top: 10px;
    }
    .options label {
      display: block;
      margin-bottom: 5px;
    }
    .buttons button {
      margin: 5px;
    }
    .status-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }
    .status-btn {
      width: 30px;
      height: 30px;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .not-visited { background: #d3d3d3; }
    .not-answered { background: #f0ad4e; }
    .answered { background: #5cb85c; }
    .review { background: #800080; }
    .ans-review { background: #1e90ff; }
    .legend span {
      display: inline-block;
      width: 15px;
      height: 15px;
      margin-right: 5px;
    }
    .timer {
      font-size: 18px;
      font-weight: bold;
    }
    .student-info {
      font-size: 14px;
      line-height: 1.4;
    }
    .submit-btn:disabled {
      background-color: grey;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: not-allowed;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="student-info">
      <strong>Candidate:</strong> <span id="studentName">Loading...</span><br>
      <strong>Roll No:</strong> <span id="rollNumber">Loading...</span><br>
      <strong>Reg No:</strong> <span id="regNumber">Loading...</span>
    </div>
    <div class="timer" id="timer">30:00</div>
  </div>
  <div class="container">
    <div class="left-panel">
      <div class="question-box" id="question-box">
        <div class="question-number" id="q-number"></div>
        <div class="question-text" id="q-text"></div>
        <div class="options" id="q-options"></div>
      </div>
      <div class="buttons">
        <button onclick="saveAndNext()">Save & Next</button>
        <button onclick="markForReview()">Mark for Review</button>
        <button onclick="clearResponse()">Clear Response</button>
        <!--<button class="submit-btn" disabled>Final Submit (Auto)</button>-->
        <button class="submit-btn" onclick="finalSubmit()">Final Submit</button>
      </div>
    </div>
    <div class="right-panel">
      <h4>Question Status</h4>
      <div class="status-grid" id="status-grid"></div>
      <div class="legend">
        <p><span class="not-visited"></span> Not Visited</p>
        <p><span class="not-answered"></span> Not Answered</p>
        <p><span class="answered"></span> Answered</p>
        <p><span class="review"></span> Marked for Review</p>
        <p><span class="ans-review"></span> Answered & Review</p>
      </div>
    </div>
  </div>
 <!-- <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const firebaseConfig = {
  apiKey: "AIzaSyAz-yo7PmFo0eFyzfjQwCP3yiB5GqqpTp0",
  authDomain: "studentdashboard-681a8.firebaseapp.com",
  projectId: "studentdashboard-681a8",
  storageBucket: "studentdashboard-681a8.firebasestorage.app",
  messagingSenderId: "171483691299",
  appId: "1:171483691299:web:f2bc4e00b696c55b4cf496",
  measurementId: "G-RVFB0Z9TFS"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const questions = [
      {
        question: "Which of the following is used to define a block of code in Python?",
        options: ["Curly braces", "Parentheses", "Indentation", "Quotation marks"],
        answer: 2
      },
      {
        question: "What is the output of: print(2 ** 3 ** 2)?",
        options: ["64", "512", "256", "None"],
        answer: 1
      },
      {
        question: "Which of these is a mutable built-in type in Python?",
        options: ["str", "list", "tuple", "int"],
        answer: 1
      },
      {
        question: "Which of these methods can be used with dictionaries?",
        options: ["append()", "add()", "update()", "extend()"],
        answer: 2
      },
      {
        question: "What is the result of list(range(0, 10, 2))?",
        options: ["[2, 4, 6, 8, 10]", "[0, 2, 4, 6, 8]", "[1, 3, 5, 7, 9]", "[0, 2, 4, 6, 8, 10]"],
        answer: 1
      },
      {
        question: "Which module in Python supports regular expressions?",
        options: ["pyregex", "regexlib", "re", "regexp"],
        answer: 2
      },
      {
        question: "What is the correct syntax to open a file named 'data.txt' for reading?",
        options: ["open('data.txt', 'r')", "open('data.txt', 'read')", "file('data.txt')", "open.read('data.txt')"],
        answer: 0
      },
      {
        question: "Which keyword is used to create a generator in Python?",
        options: ["iter", "yield", "return", "gen"],
        answer: 1
      },
      {
        question: "Which of these is not a valid set operation?",
        options: ["union()", "intersect()", "difference()", "symmetric_difference()"],
        answer: 1
      },
      {
        question: "What is the output of print(type(lambda x: x))?",
        options: ["<class 'function'>", "<class 'lambda'>", "<class 'object'>", "<lambda 'function'>"],
        answer: 0
      },
      {
        question: "Which of these is a correct decorator syntax?",
        options: ["@decorator", "#decorator", "$decorator", "decorator@"],
        answer: 0
      },
      {
        question: "What does the 'pass' keyword do in Python?",
        options: ["Stops execution", "Skips to next line", "Does nothing", "Throws exception"],
        answer: 2
      },
      {
        question: "Which of these exceptions is raised when dividing by zero?",
        options: ["ZeroError", "ZeroDivisionError", "ArithmeticError", "MathError"],
        answer: 1
      },
      {
        question: "Which of these can be used as keys in a dictionary?",
        options: ["lists", "sets", "tuples", "dictionaries"],
        answer: 2
      },
      {
        question: "Which operator is used for floor division in Python?",
        options: ["/", "%", "//", "div"],
        answer: 2
      },
      {
        question: "Which built-in function returns the length of a list?",
        options: ["length()", "size()", "len()", "count()"],
        answer: 2
      },
      {
        question: "Which function converts a string to an integer in Python?",
        options: ["parseInt()", "int()", "float()", "str()"],
        answer: 1
      },
      {
        question: "Which method is used to add an item at the end of a list?",
        options: ["insert()", "add()", "append()", "extend()"],
        answer: 2
      },
      {
        question: "Which of the following data types is immutable?",
        options: ["list", "set", "dict", "str"],
        answer: 3
      },
      {
        question: "Which function is used to get user input in Python 3?",
        options: ["get()", "input()", "read()", "scan()"],
        answer: 1
      }
    ];
let current = 0;
let responses = Array(questions.length).fill(null);
let status = Array(questions.length).fill("not-visited");
const TOTAL_TIME_SECONDS = 1 * 60;

function loadStudentDetails() {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");
  if (!name || !roll || !reg) {
    alert("Unauthorized access. Please login first.");
    window.location.href = "index.html";
    return;
  }
  document.getElementById("studentName").textContent = name;
  document.getElementById("rollNumber").textContent = roll;
  document.getElementById("regNumber").textContent = reg;
}

function loadQuestion(index) {
  const q = questions[index];
  document.getElementById("q-number").textContent = `Q${index + 1}`;
  document.getElementById("q-text").textContent = q.question;
  document.getElementById("q-options").innerHTML = q.options.map((opt, i) =>
    `<label><input type="radio" name="option" value="${i}" ${responses[index] == i ? 'checked' : ''}> ${opt}</label>`
  ).join("");
  if (status[index] === "not-visited") status[index] = "not-answered";
  renderStatus();
}

function renderStatus() {
  document.getElementById("status-grid").innerHTML = status.map((s, i) =>
    `<button class="status-btn ${s}" onclick="goto(${i})">${i + 1}</button>`
  ).join("");
}

window.saveAndNext = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = status[current] === "review" ? "ans-review" : "answered";
  } else {
    status[current] = "not-answered";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.markForReview = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = "ans-review";
  } else {
    status[current] = "review";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.clearResponse = function () {
  responses[current] = null;
  status[current] = "not-answered";
  loadQuestion(current);
}

window.goto = function (index) {
  current = index;
  loadQuestion(index);
}

function startTimer() {
  const timerElement = document.getElementById("timer");
  let startTime = sessionStorage.getItem("examStartTime");
  if (!startTime) {
    startTime = Date.now();
    sessionStorage.setItem("examStartTime", startTime);
  } else {
    startTime = parseInt(startTime);
  }
  const interval = setInterval(() => {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    const remaining = TOTAL_TIME_SECONDS - elapsed;
    if (remaining <= 0) {
      clearInterval(interval);
      alert("â° Time's up! Submitting your exam...");
      finalSubmit();
    }
    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerElement.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }, 1000);
}

window.finalSubmit = async function () {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  const total = questions.length;
  const answered = responses.filter(r => r !== null).length;
  const notAnswered = status.filter(s => s === "not-answered").length;
  const review = status.filter(s => s === "review").length;
  const ansReview = status.filter(s => s === "ans-review").length;

  const responseData = {
    name,
    roll,
    reg,
    responses,
    status,
    answered,
    notAnswered,
    review,
    ansReview,
    submittedAt: serverTimestamp()
  };

  try {
    await setDoc(doc(db, "examResponses", reg), responseData);
    alert(`Exam Submitted Successfully!\nTotal Questions: ${total}\nAnswered: ${answered}\nNot Answered: ${notAnswered}\nReview: ${review}\nAnswered & Review: ${ansReview}`);
    sessionStorage.clear();
    window.location.href = "thankyou.html";
  } catch (err) {
    alert("âŒ Submission failed. Please check your connection.");
    console.error("Firestore Error:", err);
  }
}

window.onload = () => {
  loadStudentDetails();
  loadQuestion(current);
  startTimer();
  window.onbeforeunload = null;
}

document.addEventListener("keydown", function (e) {
  if ((e.key === "F5") || (e.ctrlKey && e.key === "r")) {
    e.preventDefault();
    alert("ðŸ”’ Refresh is disabled during the exam!");
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());
history.pushState(null, null, location.href);
window.onpopstate = function () { history.go(1); }

  </script>-->
 <!-- <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAz-yo7PmFo0eFyzfjQwCP3yiB5GqqpTp0",
  authDomain: "studentdashboard-681a8.firebaseapp.com",
  projectId: "studentdashboard-681a8",
  storageBucket: "studentdashboard-681a8.firebasestorage.app",
  messagingSenderId: "171483691299",
  appId: "1:171483691299:web:f2bc4e00b696c55b4cf496",
  measurementId: "G-RVFB0Z9TFS"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const questions = [ /* SAME 20 questions as before */ 
  {
    question: "Which of the following is used to define a block of code in Python?",
    options: ["Curly braces", "Parentheses", "Indentation", "Quotation marks"],
    answer: 2
  },
  {
    question: "What is the output of: print(2 ** 3 ** 2)?",
    options: ["64", "512", "256", "None"],
    answer: 1
  },
  {
    question: "Which of these is a mutable built-in type in Python?",
    options: ["str", "list", "tuple", "int"],
    answer: 1
  },
  {
    question: "Which of these methods can be used with dictionaries?",
    options: ["append()", "add()", "update()", "extend()"],
    answer: 2
  },
  {
    question: "What is the result of list(range(0, 10, 2))?",
    options: ["[2, 4, 6, 8, 10]", "[0, 2, 4, 6, 8]", "[1, 3, 5, 7, 9]", "[0, 2, 4, 6, 8, 10]"],
    answer: 1
  },
  {
    question: "Which module in Python supports regular expressions?",
    options: ["pyregex", "regexlib", "re", "regexp"],
    answer: 2
  },
  {
    question: "What is the correct syntax to open a file named 'data.txt' for reading?",
    options: ["open('data.txt', 'r')", "open('data.txt', 'read')", "file('data.txt')", "open.read('data.txt')"],
    answer: 0
  },
  {
    question: "Which keyword is used to create a generator in Python?",
    options: ["iter", "yield", "return", "gen"],
    answer: 1
  },
  {
    question: "Which of these is not a valid set operation?",
    options: ["union()", "intersect()", "difference()", "symmetric_difference()"],
    answer: 1
  },
  {
    question: "What is the output of print(type(lambda x: x))?",
    options: ["<class 'function'>", "<class 'lambda'>", "<class 'object'>", "<lambda 'function'>"],
    answer: 0
  },
  {
    question: "Which of these is a correct decorator syntax?",
    options: ["@decorator", "#decorator", "$decorator", "decorator@"],
    answer: 0
  },
  {
    question: "What does the 'pass' keyword do in Python?",
    options: ["Stops execution", "Skips to next line", "Does nothing", "Throws exception"],
    answer: 2
  },
  {
    question: "Which of these exceptions is raised when dividing by zero?",
    options: ["ZeroError", "ZeroDivisionError", "ArithmeticError", "MathError"],
    answer: 1
  },
  {
    question: "Which of these can be used as keys in a dictionary?",
    options: ["lists", "sets", "tuples", "dictionaries"],
    answer: 2
  },
  {
    question: "Which operator is used for floor division in Python?",
    options: ["/", "%", "//", "div"],
    answer: 2
  },
  {
    question: "Which built-in function returns the length of a list?",
    options: ["length()", "size()", "len()", "count()"],
    answer: 2
  },
  {
    question: "Which function converts a string to an integer in Python?",
    options: ["parseInt()", "int()", "float()", "str()"],
    answer: 1
  },
  {
    question: "Which method is used to add an item at the end of a list?",
    options: ["insert()", "add()", "append()", "extend()"],
    answer: 2
  },
  {
    question: "Which of the following data types is immutable?",
    options: ["list", "set", "dict", "str"],
    answer: 3
  },
  {
    question: "Which function is used to get user input in Python 3?",
    options: ["get()", "input()", "read()", "scan()"],
    answer: 1
  }
];

let current = parseInt(sessionStorage.getItem("currentQuestion") || "0");
let responses = JSON.parse(sessionStorage.getItem("responses") || JSON.stringify(Array(questions.length).fill(null)));
let status = JSON.parse(sessionStorage.getItem("status") || JSON.stringify(Array(questions.length).fill("not-visited")));

function loadStudentDetails() {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");
  if (!name || !roll || !reg) {
    alert("Unauthorized access. Please login first.");
    window.location.href = "index.html";
    return;
  }
  document.getElementById("studentName").textContent = name;
  document.getElementById("rollNumber").textContent = roll;
  document.getElementById("regNumber").textContent = reg;
}

function loadQuestion(index) {
  const q = questions[index];
  document.getElementById("q-number").textContent = `Q${index + 1}`;
  document.getElementById("q-text").textContent = q.question;
  document.getElementById("q-options").innerHTML = q.options.map((opt, i) =>
    `<label><input type="radio" name="option" value="${i}" ${responses[index] === i ? 'checked' : ''}> ${opt}</label>`
  ).join("");

  if (status[index] === "not-visited") status[index] = "not-answered";
  renderStatus();
  persistData();
}

function renderStatus() {
  document.getElementById("status-grid").innerHTML = status.map((s, i) =>
    `<button class="status-btn ${s}" onclick="goto(${i})">${i + 1}</button>`
  ).join("");
}

function persistData() {
  sessionStorage.setItem("responses", JSON.stringify(responses));
  sessionStorage.setItem("status", JSON.stringify(status));
  sessionStorage.setItem("currentQuestion", current.toString());
}

window.saveAndNext = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = status[current] === "review" ? "ans-review" : "answered";
  } else {
    status[current] = "not-answered";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.markForReview = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = "ans-review";
  } else {
    status[current] = "review";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.clearResponse = function () {
  responses[current] = null;
  status[current] = "not-answered";
  loadQuestion(current);
}

window.goto = function (index) {
  current = index;
  loadQuestion(index);
}

function startTimer() {
  const timerElement = document.getElementById("timer");
  let startTime = sessionStorage.getItem("examStartTime");
  if (!startTime) {
    startTime = Date.now();
    sessionStorage.setItem("examStartTime", startTime);
  } else {
    startTime = parseInt(startTime);
  }

  const interval = setInterval(() => {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    const remaining = TOTAL_TIME_SECONDS - elapsed;

    if (remaining <= 0) {
      clearInterval(interval);
      alert("â° Time's up! Submitting your exam...");
      finalSubmit();
    }

    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerElement.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }, 1000);
}

window.finalSubmit = async function () {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  const total = questions.length;
  const answered = responses.filter(r => r !== null).length;
  const notAnswered = status.filter(s => s === "not-answered").length;
  const review = status.filter(s => s === "review").length;
  const ansReview = status.filter(s => s === "ans-review").length;

  const responseData = {
    name,
    roll,
    reg,
    responses,
    status,
    answered,
    notAnswered,
    review,
    ansReview,
    submittedAt: serverTimestamp()
  };

  try {
    await setDoc(doc(db, "examResponses", reg), responseData);
    alert(`âœ… Exam Submitted!\nTotal Questions: ${total}\nAnswered: ${answered}\nNot Answered: ${notAnswered}\nReview: ${review}\nAnswered & Review: ${ansReview}`);
    sessionStorage.clear();
    window.location.href = "thankyou.html";
  } catch (err) {
    alert("âŒ Submission failed. Please check your connection.");
    console.error("Firestore Error:", err);
  }
}

window.onload = () => {
  loadStudentDetails();
  loadQuestion(current);
  startTimer();
  window.onbeforeunload = null;
}

document.addEventListener("keydown", function (e) {
  if ((e.key === "F5") || (e.ctrlKey && e.key === "r")) {
    e.preventDefault();
    alert("ðŸ”’ Refresh is disabled during the exam!");
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());
history.pushState(null, null, location.href);
window.onpopstate = function () { history.go(1); }
</script>-->
<!--<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAz-yo7PmFo0eFyzfjQwCP3yiB5GqqpTp0",
  authDomain: "studentdashboard-681a8.firebaseapp.com",
  projectId: "studentdashboard-681a8",
  storageBucket: "studentdashboard-681a8.firebasestorage.app",
  messagingSenderId: "171483691299",
  appId: "1:171483691299:web:f2bc4e00b696c55b4cf496",
  measurementId: "G-RVFB0Z9TFS"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Time in seconds ( 15 minutes)
const TOTAL_TIME_SECONDS = 15 * 60;

// Example questions (replace or load externally as needed)
const questions = [
      {
        question: "Which of the following is used to define a block of code in Python?",
        options: ["Curly braces", "Parentheses", "Indentation", "Quotation marks"],
        answer: 2
      },
      {
        question: "What is the output of: print(2 ** 3 ** 2)?",
        options: ["64", "512", "256", "None"],
        answer: 1
      },
      {
        question: "Which of these is a mutable built-in type in Python?",
        options: ["str", "list", "tuple", "int"],
        answer: 1
      },
      {
        question: "Which of these methods can be used with dictionaries?",
        options: ["append()", "add()", "update()", "extend()"],
        answer: 2
      },
      {
        question: "What is the result of list(range(0, 10, 2))?",
        options: ["[2, 4, 6, 8, 10]", "[0, 2, 4, 6, 8]", "[1, 3, 5, 7, 9]", "[0, 2, 4, 6, 8, 10]"],
        answer: 1
      },
      {
        question: "Which module in Python supports regular expressions?",
        options: ["pyregex", "regexlib", "re", "regexp"],
        answer: 2
      },
      {
        question: "What is the correct syntax to open a file named 'data.txt' for reading?",
        options: ["open('data.txt', 'r')", "open('data.txt', 'read')", "file('data.txt')", "open.read('data.txt')"],
        answer: 0
      },
      {
        question: "Which keyword is used to create a generator in Python?",
        options: ["iter", "yield", "return", "gen"],
        answer: 1
      },
      {
        question: "Which of these is not a valid set operation?",
        options: ["union()", "intersect()", "difference()", "symmetric_difference()"],
        answer: 1
      },
      {
        question: "What is the output of print(type(lambda x: x))?",
        options: ["class 'function'", "class 'lambda'", "class 'object'", "lambda 'function'"],
        answer: 0
      },
      {
        question: "Which of these is a correct decorator syntax?",
        options: ["@decorator", "#decorator", "$decorator", "decorator@"],
        answer: 0
      },
      {
        question: "What does the 'pass' keyword do in Python?",
        options: ["Stops execution", "Skips to next line", "Does nothing", "Throws exception"],
        answer: 2
      },
      {
        question: "Which of these exceptions is raised when dividing by zero?",
        options: ["ZeroError", "ZeroDivisionError", "ArithmeticError", "MathError"],
        answer: 1
      },
      {
        question: "Which of these can be used as keys in a dictionary?",
        options: ["lists", "sets", "tuples", "dictionaries"],
        answer: 2
      },
      {
        question: "Which operator is used for floor division in Python?",
        options: ["/", "%", "//", "div"],
        answer: 2
      },
      {
        question: "Which built-in function returns the length of a list?",
        options: ["length()", "size()", "len()", "count()"],
        answer: 2
      },
      {
        question: "Which function converts a string to an integer in Python?",
        options: ["parseInt()", "int()", "float()", "str()"],
        answer: 1
      },
      {
        question: "Which method is used to add an item at the end of a list?",
        options: ["insert()", "add()", "append()", "extend()"],
        answer: 2
      },
      {
        question: "Which of the following data types is immutable?",
        options: ["list", "set", "dict", "str"],
        answer: 3
      },
      {
        question: "Which function is used to get user input in Python 3?",
        options: ["get()", "input()", "read()", "scan()"],
        answer: 1
      }
    ];

let current = parseInt(sessionStorage.getItem("currentQuestion") || "0");
let responses = JSON.parse(sessionStorage.getItem("responses") || JSON.stringify(Array(questions.length).fill(null)));
let status = JSON.parse(sessionStorage.getItem("status") || JSON.stringify(Array(questions.length).fill("not-visited")));

function loadStudentDetails() {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");
  if (!name || !roll || !reg) {
    alert("Unauthorized access. Please login first.");
    window.location.href = "index.html";
    return;
  }
  document.getElementById("studentName").textContent = name;
  document.getElementById("rollNumber").textContent = roll;
  document.getElementById("regNumber").textContent = reg;
}

function loadQuestion(index) {
  const q = questions[index];
  document.getElementById("q-number").textContent = `Q${index + 1}`;
  document.getElementById("q-text").textContent = q.question;
  document.getElementById("q-options").innerHTML = q.options.map((opt, i) =>
    `<label><input type="radio" name="option" value="${i}" ${responses[index] === i ? 'checked' : ''}> ${opt}</label>`
  ).join("");

  if (status[index] === "not-visited") status[index] = "not-answered";
  renderStatus();
  persistData();
}

function renderStatus() {
  document.getElementById("status-grid").innerHTML = status.map((s, i) =>
    `<button class="status-btn ${s}" onclick="goto(${i})">${i + 1}</button>`
  ).join("");
}

function persistData() {
  sessionStorage.setItem("responses", JSON.stringify(responses));
  sessionStorage.setItem("status", JSON.stringify(status));
  sessionStorage.setItem("currentQuestion", current.toString());
}

window.saveAndNext = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = status[current] === "review" ? "ans-review" : "answered";
  } else {
    status[current] = "not-answered";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.markForReview = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = "ans-review";
  } else {
    status[current] = "review";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.clearResponse = function () {
  responses[current] = null;
  status[current] = "not-answered";
  loadQuestion(current);
}

window.goto = function (index) {
  current = index;
  loadQuestion(index);
}

function startTimer() {
  const timerElement = document.getElementById("timer");
  let startTime = sessionStorage.getItem("examStartTime");

  if (!startTime) {
    startTime = Date.now();
    sessionStorage.setItem("examStartTime", startTime);
  } else {
    startTime = parseInt(startTime);
  }

  const interval = setInterval(() => {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    const remaining = TOTAL_TIME_SECONDS - elapsed;

    /*if (remaining <= 0) {
      clearInterval(interval);
      alert("â° Time's up! Submitting your exam...");
      finalSubmit();
    }*/
    if (remaining <= 0) {
  clearInterval(interval);
  alert("â° Time's up! You can now submit your exam manually.");
  document.querySelector(".submit-btn").disabled = false;
    }

    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerElement.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }, 1000);
}

window.finalSubmit = async function () {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  const total = questions.length;
  const answered = responses.filter(r => r !== null).length;
  const notAnswered = status.filter(s => s === "not-answered").length;
  const review = status.filter(s => s === "review").length;
  const ansReview = status.filter(s => s === "ans-review").length;

  const responseData = {
    name, roll, reg,
    responses, status,
    answered, notAnswered,
    review, ansReview,
    submittedAt: serverTimestamp()
  };

  try {
    await setDoc(doc(db, "examResponses", reg), responseData);
    alert(`âœ… Exam Submitted!\nTotal: ${total}\nAnswered: ${answered}\nNot Answered: ${notAnswered}\nReview: ${review}\nAnswered & Review: ${ansReview}`);
    sessionStorage.clear();
    window.location.href = "thankyou.html";
  } catch (err) {
    alert("âŒ Submission failed. Please check your internet.");
    console.error("Submission Error:", err);
  }
}

window.onload = () => {
  loadStudentDetails();
  loadQuestion(current);
  startTimer();

  // Prevent leaving page
  window.onbeforeunload = null;
};

// Security & Navigation Lock
document.addEventListener("keydown", function (e) {
  if (e.key === "F5" || (e.ctrlKey && e.key === "r")) {
    e.preventDefault();
    alert("ðŸ”’ Refresh is disabled during the exam!");
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());

history.pushState(null, null, location.href);
window.onpopstate = () => history.go(1);
</script>-->
<script type="module">
 import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
 import { getFirestore, setDoc, getDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Firebase Config
 const firebaseConfig = {
  apiKey: "AIzaSyAz-yo7PmFo0eFyzfjQwCP3yiB5GqqpTp0",
  authDomain: "studentdashboard-681a8.firebaseapp.com",
  projectId: "studentdashboard-681a8",
  storageBucket: "studentdashboard-681a8.firebasestorage.app",
  messagingSenderId: "171483691299",
  appId: "1:171483691299:web:f2bc4e00b696c55b4cf496",
  measurementId: "G-RVFB0Z9TFS"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// â± Time in seconds (30 minutes)
 const TOTAL_TIME_SECONDS = 30 * 60;

// âœ… Set allowed attempt count
 const ALLOWED_ATTEMPTS = 1;

 const questions = [
  {
    question: "Which of the following is a mutable data type in Python?",
    options: ["List", "Tuple", "String", "Integer"],
    answer: 0
  },
  {
    question: "What is the output of: x = 5; y = 2; print(x ** y)?",
    options: ["25", "10", "3", "8"],
    answer: 0
  },
  {
    question: "Which operator is used for floor division in Python?",
    options: ["/", "//", "%", "**"],
    answer: 1
  },
  {
    question: "What will be the output of: print(10 > 5 and 3 < 2)?",
    options: ["True", "False", "Error", "None"],
    answer: 1
  },
  {
    question: "Which of these is used to take input from the user?",
    options: ["input()", "scan()", "read()", "get()"],
    answer: 0
  },
  {
    question: "What will be the output of: print('Python'[-1])?",
    options: ["P", "n", "o", "Error"],
    answer: 1
  },
  {
    question: "What is the correct way to define a function in Python?",
    options: ["def func():", "function func():", "fun func():", "define func():"],
    answer: 0
  },
  {
    question: "What will len([1, 2, 3, 4]) return?",
    options: ["3", "4", "Error", "None"],
    answer: 1
  },
  {
    question: "Which of the following is a valid lambda function syntax?",
    options: ["lambda x: x+1", "def lambda(x): x+1", "lambda(x) => x+1", "lambda x { return x+1 }"],
    answer: 0
  },
  {
    question: "What is recursion in Python?",
    options: ["Function calling itself", "Looping over list", "Returning multiple values", "Lambda function"],
    answer: 0
  },
  {
    question: "Which of these is an immutable data type?",
    options: ["List", "Set", "Tuple", "Dictionary"],
    answer: 2
  },
  {
    question: "How do you create a set in Python?",
    options: ["{}", "[]", "()", "set()"],
    answer: 3
  },
  {
    question: "What is the output of: print(type({'a':1, 'b':2}))?",
    options: ["list", "tuple", "dict", "set"],
    answer: 2
  },
  {
    question: "Which of the following is used to format strings in Python?",
    options: ["% operator", "f-strings", "format() method", "All of the above"],
    answer: 3
  },
  {
    question: "What will open('file.txt', 'w') do in Python?",
    options: ["Read the file", "Write to the file", "Append to file", "Delete the file"],
    answer: 1
  },
  {
    question: "Which exception is raised when division by zero occurs?",
    options: ["ZeroDivisionError", "ValueError", "TypeError", "IndexError"],
    answer: 0
  },
  {
    question: "How do you import the math module?",
    options: ["import math", "include math", "from math import all", "import Math"],
    answer: 0
  },
  {
    question: "Which of these is a valid way to calculate the factorial of 5 using math module?",
    options: ["math.factorial(5)", "factorial(5)", "math.factor(5)", "factorial5()"],
    answer: 0
  },
  {
    question: "What will map(lambda x: x*2, [1,2,3]) return in Python 3?",
    options: ["[2,4,6]", "(2,4,6)", "map object", "Error"],
    answer: 2
  },
  {
    question: "What does filter() return in Python 3?",
    options: ["List", "Tuple", "Iterator", "Set"],
    answer: 2
  },
  {
    question: "What will be the output of: list(range(2, 10, 2))?",
    options: ["[2, 4, 6, 8]", "[2, 3, 4, 5, 6, 7, 8, 9]", "[2, 10]", "[2, 4, 8, 10]"],
    answer: 0
  },
  {
    question: "Which type of argument is mandatory in function call?",
    options: ["Default argument", "Required argument", "Keyword argument", "Arbitrary argument"],
    answer: 1
  },
  {
    question: "What will *args collect in a function definition?",
    options: ["Dictionary", "Tuple of arguments", "List", "Single argument only"],
    answer: 1
  },
  {
    question: "What will **kwargs collect in a function definition?",
    options: ["List of values", "Tuple of values", "Dictionary of key-value pairs", "String"],
    answer: 2
  },
  {
    question: "Which keyword is used as a placeholder in Python functions?",
    options: ["continue", "break", "pass", "skip"],
    answer: 2
  },
  {
    question: "What is the output of: [x**2 for x in range(3)]?",
    options: ["[0,1,2]", "[1,4,9]", "[0,1,4]", "[2,4,6]"],
    answer: 2
  },
  {
    question: "What is the difference between list and tuple?",
    options: ["List is mutable, tuple is immutable", "Tuple is mutable, list is immutable", "Both are mutable", "Both are immutable"],
    answer: 0
  },
  {
    question: "Which method adds an element at the end of a list?",
    options: ["add()", "append()", "insert()", "extend()"],
    answer: 1
  },
  {
    question: "Which method removes the last element of a list?",
    options: ["remove()", "pop()", "del()", "clear()"],
    answer: 1
  },
  {
    question: "What will 'Hello'.lower() return?",
    options: ["HELLO", "hello", "Hello", "error"],
    answer: 1
  },
  {
    question: "What will 'Python'.replace('P','J') return?",
    options: ["Python", "Jython", "JYthon", "JyThon"],
    answer: 1
  },
  {
    question: "How can you check if a key exists in a dictionary?",
    options: ["if key in dict", "if key exists dict", "dict.has(key)", "dict.contains(key)"],
    answer: 0
  },
  {
    question: "Which of the following is a correct way to create an empty dictionary?",
    options: ["{}", "[]", "()", "dict[]"],
    answer: 0
  },
  {
    question: "Which of the following statements is correct for a Python set?",
    options: ["Sets are ordered", "Sets allow duplicate elements", "Sets are mutable and unordered", "Sets are immutable"],
    answer: 2
  },
  {
    question: "Which of the following can be used to iterate over a list?",
    options: ["for loop", "while loop", "both", "None"],
    answer: 2
  },
  {
    question: "Which of the following statements about slicing is correct?",
    options: ["list[1:5] includes index 5", "list[1:5] excludes index 5", "list[1:5] includes index 0", "list[1:5] includes all elements"],
    answer: 1
  },
  {
    question: "What will [i for i in range(5) if i%2==0] return?",
    options: ["[1,3]", "[0,2,4]", "[0,1,2,3,4]", "[2,4]"],
    answer: 1
  },
  {
    question: "Which of the following is a valid dictionary comprehension?",
    options: ["{x:x**2 for x in range(3)}", "{x**2:x for x in range(3)}", "[x:x**2 for x in range(3)]", "(x:x**2 for x in range(3))"],
    answer: 0
  },
  {
    question: "What will be the output of: bool([])?",
    options: ["True", "False", "Error", "None"],
    answer: 1
  },
  {
    question: "What is the output of: 'abc' * 3?",
    options: ["'abcabcabc'", "'abc3'", "['abc', 'abc', 'abc']", "Error"],
    answer: 0
  },
  {
    question: "Which of the following is not a valid Python identifier?",
    options: ["my_var", "_var1", "2var", "var_2"],
    answer: 2
  },
  {
    question: "What is the output of: list(map(str, [1,2,3]))?",
    options: ["['1','2','3']", "[1,2,3]", "(1,2,3)", "Error"],
    answer: 0
  },
  {
    question: "Which of the following expressions gives the ASCII value of a character?",
    options: ["ord('A')", "chr('A')", "ascii('A')", "code('A')"],
    answer: 0
  },
  {
    question: "What is the output of: 10 % 3?",
    options: ["3", "1", "0", "Error"],
    answer: 1
  },
  {
    question: "What will zip([1,2], ['a','b']) return?",
    options: ["[(1,'a'), (2,'b')]", "zip object", "[1,'a',2,'b']", "Error"],
    answer: 1
  },
  {
    question: "Which of the following is true about Python lists?",
    options: ["Lists can store mixed data types", "Lists are immutable", "Lists cannot contain duplicates", "Lists are ordered but immutable"],
    answer: 0
  },
  {
    question: "Which of the following creates an iterator?",
    options: ["iter([1,2,3])", "[1,2,3]", "range(3)", "None"],
    answer: 0
  },
  {
    question: "Which of the following is used to combine multiple iterables in Python?",
    options: ["functools", "itertools", "operator", "math"],
    answer: 1
  }
];
/*const questions = [
  {
    question: "What will be the output of the following code?\n\nprint('Hello', 'World', sep='-')",
    options: [
      "Hello World",
      "Hello-World",
      "Hello- World",
      "Error"
    ],
    answer: 1
  },
  {
    question: "Which of the following is a valid variable name in Python?",
    options: ["2name", "name_2", "for", "class"],
    answer: 1
  },
  {
    question: "What is the default return type of input() function in Python?",
    options: ["int", "float", "str", "bool"],
    answer: 2
  },
  {
    question: "Which of the following is a mutable data type?",
    options: ["tuple", "list", "str", "frozenset"],
    answer: 1
  },
  {
    question: "Which keyword is reserved in Python?",
    options: ["print", "while", "add", "sum"],
    answer: 1
  },
  {
    question: "What is the output of int(9.9)?",
    options: ["9.9", "9", "10", "Error"],
    answer: 1
  },
  {
    question: "What will be the output of the following code?\n\na = 5\nb = 2\nprint(a // b)",
    options: ["2.5", "2", "3", "Error"],
    answer: 1
  },
  {
    question: "Which operator is used for exponentiation in Python?",
    options: ["^", "**", "exp()", "pow"],
    answer: 1
  },
  {
    question: "Which of the following is correct ternary syntax?",
    options: [
      "x = if a > b ? a : b",
      "x = a if a > b else b",
      "x = (a > b) ? a : b",
      "x = a > b ? a : b"
    ],
    answer: 1
  },
  {
    question: "Which of the following is a function without return?",
    options: [
      "def f(): return 5",
      "def f(): pass",
      "def f(): print('Hello')",
      "Both B and C"
    ],
    answer: 3
  },
  {
    question: "Which statement about lambda function is true?",
    options: [
      "It can have multiple expressions",
      "It always returns a value",
      "It can contain loops",
      "It is defined using def keyword"
    ],
    answer: 1
  },
  {
    question: "Which module must be imported to use reduce()?",
    options: ["functools", "itertools", "math", "operator"],
    answer: 0
  },
  {
    question: "What does filter() return in Python 3?",
    options: ["List", "Tuple", "Iterator", "Set"],
    answer: 2
  },
  {
    question: "What is the output of math.floor(5.9)?",
    options: ["5.9", "5", "6", "Error"],
    answer: 1
  },
  {
    question: "What will map(lambda x: x*2, [1,2,3]) return?",
    options: [
      "[2, 4, 6]",
      "(2, 4, 6)",
      "map object",
      "Error"
    ],
    answer: 2
  },
  {
    question: "What is the output of list(range(2, 10, 2))?",
    options: ["[2, 4, 6, 8]", "[2, 3, 4, 5, 6, 7, 8, 9]", "[2, 10]", "[2, 4, 8, 10]"],
    answer: 0
  },
  {
    question: "Which type of argument is mandatory in function call?",
    options: ["Default argument", "Required argument", "Keyword argument", "Arbitrary argument"],
    answer: 1
  },
  {
    question: "What will *args collect in a function definition?",
    options: ["Dictionary", "Tuple of arguments", "List", "Single argument only"],
    answer: 1
  },
  {
    question: "What will **kwargs collect in a function definition?",
    options: ["List of values", "Tuple of values", "Dictionary of key-value pairs", "String"],
    answer: 2
  },
  {
    question: "Which keyword is used as a placeholder in Python functions?",
    options: ["continue", "break", "pass", "skip"],
    answer: 2
  }
];*/

let current = parseInt(sessionStorage.getItem("currentQuestion") || "0");
let responses = JSON.parse(sessionStorage.getItem("responses") || JSON.stringify(Array(questions.length).fill(null)));
let status = JSON.parse(sessionStorage.getItem("status") || JSON.stringify(Array(questions.length).fill("not-visited")));

async function loadStudentDetails() {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  if (!name || !roll || !reg) {
    alert("Unauthorized access. Please login first.");
    window.location.href = "index.html";
    return;
  }

  // ðŸ” Check previous attempts
  const responseRef = doc(db, "examResponses", reg);
  const responseSnap = await getDoc(responseRef);

  if (responseSnap.exists()) {
    const data = responseSnap.data();
    if ((data.attempts || 1) >= ALLOWED_ATTEMPTS) {
      alert("âš ï¸ You have already attempted this exam. Only one attempt is allowed.");
      window.location.href = "thankyou.html";
      return;
    }
  }

  document.getElementById("studentName").textContent = name;
  document.getElementById("rollNumber").textContent = roll;
  document.getElementById("regNumber").textContent = reg;
}

function loadQuestion(index) {
  const q = questions[index];
  document.getElementById("q-number").textContent = `Q${index + 1}`;
  document.getElementById("q-text").textContent = q.question;
  document.getElementById("q-options").innerHTML = q.options.map((opt, i) =>
    `<label><input type="radio" name="option" value="${i}" ${responses[index] === i ? 'checked' : ''}> ${opt}</label>`
  ).join("");

  if (status[index] === "not-visited") status[index] = "not-answered";
  renderStatus();
  persistData();
}

function renderStatus() {
  document.getElementById("status-grid").innerHTML = status.map((s, i) =>
    `<button class="status-btn ${s}" onclick="goto(${i})">${i + 1}</button>`
  ).join("");
}

function persistData() {
  sessionStorage.setItem("responses", JSON.stringify(responses));
  sessionStorage.setItem("status", JSON.stringify(status));
  sessionStorage.setItem("currentQuestion", current.toString());
}

window.saveAndNext = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = status[current] === "review" ? "ans-review" : "answered";
  } else {
    status[current] = "not-answered";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.markForReview = function () {
  const selected = document.querySelector('input[name="option"]:checked');
  if (selected) {
    responses[current] = parseInt(selected.value);
    status[current] = "ans-review";
  } else {
    status[current] = "review";
  }
  if (current < questions.length - 1) current++;
  loadQuestion(current);
}

window.clearResponse = function () {
  responses[current] = null;
  status[current] = "not-answered";
  loadQuestion(current);
}

window.goto = function (index) {
  current = index;
  loadQuestion(index);
}

function startTimer() {
  const timerElement = document.getElementById("timer");
  let startTime = sessionStorage.getItem("examStartTime");

  if (!startTime) {
    startTime = Date.now();
    sessionStorage.setItem("examStartTime", startTime);
  } else {
    startTime = parseInt(startTime);
  }

  const interval = setInterval(() => {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    const remaining = TOTAL_TIME_SECONDS - elapsed;

    if (remaining <= 0) {
      clearInterval(interval);
      alert("â° Time's up! You can now submit your exam manually.");
      document.querySelector(".submit-btn").disabled = false;
    }

    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerElement.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }, 1000);
}

window.finalSubmit = async function () {
  const name = sessionStorage.getItem("username");
  const roll = sessionStorage.getItem("rollNo");
  const reg = sessionStorage.getItem("regNo");

  const total = questions.length;
  const answered = responses.filter(r => r !== null).length;
  const notAnswered = status.filter(s => s === "not-answered").length;
  const review = status.filter(s => s === "review").length;
  const ansReview = status.filter(s => s === "ans-review").length;

  const responseRef = doc(db, "examResponses", reg);
  const existingSnap = await getDoc(responseRef);
  let attemptCount = 1;

  if (existingSnap.exists()) {
    const existingData = existingSnap.data();
    attemptCount = (existingData.attempts || 1) + 1;
  }

  const responseData = {
    name, roll, reg,
    responses, status,
    answered, notAnswered,
    review, ansReview,
    attempts: attemptCount,
    submittedAt: serverTimestamp()
  };

  try {
    await setDoc(responseRef, responseData);
    alert(`âœ… Exam Submitted!\nTotal: ${total}\nAnswered: ${answered}\nNot Answered: ${notAnswered}\nReview: ${review}\nAnswered & Review: ${ansReview}`);
    sessionStorage.clear();
    window.location.href = "thankyou.html";
  } catch (err) {
    alert("âŒ Submission failed. Please check your internet.");
    console.error("Submission Error:", err);
  }
}

window.onload = () => {
  loadStudentDetails();
  loadQuestion(current);
  startTimer();

  // Prevent leaving page
  window.onbeforeunload = null;
};

// Security & Navigation Lock
document.addEventListener("keydown", function (e) {
  if (e.key === "F5" || (e.ctrlKey && e.key === "r")) {
    e.preventDefault();
    alert("ðŸ”’ Refresh is disabled during the exam!");
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());

history.pushState(null, null, location.href);
window.onpopstate = () => history.go(1);
  </script>
</body>
</html>
